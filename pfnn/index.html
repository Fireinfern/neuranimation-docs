
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Sebastian Silva, Sergio Sugahara, Willy Ugarte">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.8">
    
    
      
        <title>PFNN - Neuranimation Package</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.92558b1b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#phase-functioned-neural-network" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Neuranimation Package" class="md-header__button md-logo" aria-label="Neuranimation Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Neuranimation Package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PFNN
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/SergioSugaharaC/Neuranimations/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Neuranimations
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Neuranimation Package" class="md-nav__button md-logo" aria-label="Neuranimation Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Neuranimation Package
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/SergioSugaharaC/Neuranimations/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Neuranimations
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          PFNN
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        PFNN
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#catmull-rom-cubic-spline" class="md-nav__link">
    Catmull-Rom Cubic Spline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pfnn-layer" class="md-nav__link">
    PFNN Layer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-design" class="md-nav__link">
    Model Design
  </a>
  
    <nav class="md-nav" aria-label="Model Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activation-function" class="md-nav__link">
    Activation Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropout-layer" class="md-nav__link">
    Dropout Layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-structure" class="md-nav__link">
    Model Structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#original-implementation-and-data" class="md-nav__link">
    Original Implementation and Data
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        Usage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#catmull-rom-cubic-spline" class="md-nav__link">
    Catmull-Rom Cubic Spline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pfnn-layer" class="md-nav__link">
    PFNN Layer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-design" class="md-nav__link">
    Model Design
  </a>
  
    <nav class="md-nav" aria-label="Model Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activation-function" class="md-nav__link">
    Activation Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropout-layer" class="md-nav__link">
    Dropout Layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-structure" class="md-nav__link">
    Model Structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#original-implementation-and-data" class="md-nav__link">
    Original Implementation and Data
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/SergioSugaharaC/Neuranimations/edit/master/docs/pfnn.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="phase-functioned-neural-network">Phase Functioned Neural Network</h1>
<p>The Phase-Function Neural Network<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> method consist in including a phase value that is responsible for the current stage of the character, while changin the values of the weights and biases of the neural Network. The change of values is determined by a special Phase Function, for Holden et al.<sup id="fnref2:1"><a class="footnote-ref" href="#fn:1">1</a></sup>  and for our version, we use Catmull-Rom Spline Function<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>. In the following sections we will explain the different components of <abbr title="Phase-Funtion Nerual Network">PFNN</abbr></p>
<h2 id="catmull-rom-cubic-spline">Catmull-Rom Cubic Spline</h2>
<p>The Catmull-Rom spline function is used within the model to achieve phases, since this function can obtain a cyclical value in a simple way, having the initial and final points with the same value. The function with only 4 control points was used in this case since they are enough to be able to give a stable and smooth phase.</p>
<p><img alt="Catmull-RomCubicSpline" src="../img/Catmull-Rom.png" /></p>
<p>The input values ​​for this function consist of sets of neural network weights, represented as <span class="arithmatex">\(\beta = \left\lbrace\alpha_ {0},\alpha_ {1},\alpha_ {2},\alpha_ {3} \right\rbrace\)</span>. With this you can define the Catmull-Rom spline function as:</p>
<div class="arithmatex">\[
\theta(p;\beta) = \alpha_{k_{1}}\\
+ w(\frac{1}{2}\alpha k_{2} - \frac{1}{2}\alpha_{k_{0}} ) \\
+ w^{2}(\alpha_{k_{0}} - \frac{5}{2}\alpha_{k_{1}}+2 \alpha_{k_{2}} - \frac{1}{2} \alpha_{k_{3}} )\\
+ w^{3}(\frac{3}{2}\alpha_{k_{1}} - \frac{3}{2}\alpha_{k_{2}}+ \frac{1}{2} \alpha_{k_{3}} - \frac{1}{2} \alpha_{k_{0}} )
\]</div>
<div class="arithmatex">\[
w=\frac{4p}{2\pi}
\]</div>
<div class="arithmatex">\[
k_{n}=[\frac{4p}{2\pi}]+ n-1
\]</div>
<p>This function returns a single set of weights, which will be used for learning this set. This definition was described by Holden, et al.<sup id="fnref3:1"><a class="footnote-ref" href="#fn:1">1</a></sup> as the Phase function.</p>
<h2 id="pfnn-layer"><abbr title="Phase-Funtion Nerual Network">PFNN</abbr> Layer</h2>
<p>We name a Layer as <abbr title="Phase-Funtion Nerual Network">PFNN</abbr> when it is presented in <span class="arithmatex">\(n\)</span> sets of weights and biases, depending on the number of phases that are needed in the project. For this project, 4 phases or control points are used, previously mentioned in the Catmull-Rom function. These sets are created in the same layers as the values ​​of the pesos or <span class="arithmatex">\(w\)</span>, and of the bias or <span class="arithmatex">\(b\)</span>. The weights variable will have the following dimensions <span class="arithmatex">\([4, x, y]\)</span>, such that <span class="arithmatex">\(x\)</span> is the dimension of the layer's input data, and <span class="arithmatex">\(y\)</span> are the layer's units. The bias variable has the dimensions <span class="arithmatex">\([4, y]\)</span>.</p>
<p>In each call of this layer, the functions defined in the Catmull-Rom section are used to obtain different sets for each input of the Catmull-Rom Spline function and obtain either the weight or the bias for this call.</p>
<p>After this, the weight obtained by the Catmull-Rom function will go through the matrix multiplication function to obtain the weights, and the output goes through the trigger or directly as an output.</p>
<p>The implementation of the NFP layer using Keras is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">PhaseLayer</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">23456</span><span class="p">),</span><span class="n">units</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">number_of_phases</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PhaseLayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nslices</span> <span class="o">=</span> <span class="n">number_of_phases</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">=</span> <span class="n">input_dim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">rng</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_alpha</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_beta</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">initial_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nslices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
    <span class="n">alpha_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]))</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="n">alpha_bound</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">alpha_bound</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">shape</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">initial_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nslices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div>
<h2 id="model-design">Model Design</h2>
<h3 id="activation-function">Activation Function</h3>
<p>For the current project, the Exponetial Linear Unity or ELU activator will be used, which is defined as:</p>
<div class="arithmatex">\[
f(x)=\left\{ \begin{array}{lcc}
\alpha(e^{x}-1), &amp; x &lt; 0 \\
x, &amp; x \geq 0 
\end{array}
\right.
\]</div>
<h3 id="dropout-layer">Dropout Layer</h3>
<p>This layer has the probability (indicated by the developer) of deactivating some neurons of the layer in which it is applied, in order to avoid an over-training of the network, assigning 0 as the weight coefficient to the neurons that are deactivated.</p>
<h3 id="model-structure">Model Structure</h3>
<p>The built model consists of the following layers in the same order:</p>
<ul>
<li><abbr title="Phase-Funtion Nerual Network">PFNN</abbr> layer, 311 input data, 512 units.</li>
<li>ELU activator</li>
<li>Dropout, with a ratio of 0.3</li>
<li><abbr title="Phase-Funtion Nerual Network">PFNN</abbr> layer, 512 input data, 512 units</li>
<li>ELU activator</li>
<li>Dropout, ratio of 0.3</li>
<li><abbr title="Phase-Funtion Nerual Network">PFNN</abbr> layer, 512 input data, 304 units</li>
</ul>
<p>The input values ​​of the first layer and the units of the last layer can change depending on the amount of activities or inputs that the character has to perform.
The code implemented for the modeling of the function is the following:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">PFNN</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PFNN</span> <span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nslices</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="o">=</span><span class="n">input_dim</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_dim</span><span class="o">=</span><span class="n">output_dim</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dropout0</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dropout1</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dropout2</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">ELU</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">layer0</span> <span class="o">=</span> <span class="n">PhaseLayer</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">input_dim</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer1</span> <span class="o">=</span> <span class="n">PhaseLayer</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layer2</span> <span class="o">=</span> <span class="n">PhaseLayer</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">output_dim</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">pscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nslices</span> <span class="o">*</span> <span class="n">inputs</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pamount</span> <span class="o">=</span> <span class="n">pscale</span> <span class="o">%</span> <span class="mf">1.0</span>

    <span class="n">pindex_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">pscale</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nslices</span>
    <span class="n">pindex_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">pindex_1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nslices</span>
    <span class="n">pindex_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">pindex_1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nslices</span>
    <span class="n">pindex_3</span> <span class="o">=</span> <span class="p">(</span><span class="n">pindex_1</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nslices</span>

    <span class="n">bamount</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">pamount</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">wamount</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">bamount</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cubic</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
      <span class="k">return</span> <span class="p">(</span>
       <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y0</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="n">y1</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="n">y2</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y3</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span> 
       <span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">y1</span><span class="o">+</span><span class="mf">2.0</span><span class="o">*</span><span class="n">y2</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y3</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span> 
       <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span>
       <span class="p">(</span><span class="n">y1</span><span class="p">))</span>

    <span class="n">W0</span> <span class="o">=</span> <span class="n">cubic</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer0</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_0</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer0</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_1</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer0</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_2</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer0</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_3</span><span class="p">),</span> 
        <span class="n">wamount</span><span class="p">)</span>
    <span class="n">W1</span> <span class="o">=</span> <span class="n">cubic</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_0</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_1</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_2</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_3</span><span class="p">),</span> 
        <span class="n">wamount</span><span class="p">)</span>
    <span class="n">W2</span> <span class="o">=</span> <span class="n">cubic</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_0</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_1</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_2</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">pindex_3</span><span class="p">),</span> 
        <span class="n">wamount</span><span class="p">)</span>

    <span class="n">b0</span> <span class="o">=</span> <span class="n">cubic</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer0</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_0</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer0</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_1</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer0</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_2</span><span class="p">),</span> 
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer0</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_3</span><span class="p">),</span> 
        <span class="n">bamount</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">cubic</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_0</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_1</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_2</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer1</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_3</span><span class="p">),</span>
        <span class="n">bamount</span><span class="p">)</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">cubic</span><span class="p">(</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_0</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_1</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_2</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">embedding_lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pindex_3</span><span class="p">),</span>
        <span class="n">bamount</span><span class="p">)</span>

    <span class="n">H0</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">H1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout0</span><span class="p">(</span><span class="n">H0</span><span class="p">),</span> <span class="n">W0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b0</span><span class="p">)</span>
    <span class="n">H2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout0</span><span class="p">(</span><span class="n">H1</span><span class="p">),</span> <span class="n">W1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">H3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout2</span><span class="p">(</span><span class="n">H2</span><span class="p">),</span> <span class="n">W2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span>

    <span class="k">return</span> <span class="n">H3</span>
</code></pre></div>
<h2 id="original-implementation-and-data">Original Implementation and Data</h2>
<p>In the original blog by Holden contains the origin version of the code for the <abbr title="Phase-Funtion Nerual Network">PFNN</abbr> Network using Theano. Here you can also find the data used for out work and th weights and biases of the output.</p>
<p><a href="https://theorangeduck.com/page/phase-functioned-neural-networks-character-control">Original Implementation of Holden</a></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Holden, D., Komura, T., &amp; Saito, J. (2017). Phase-functioned neural networks for character control. ACM Transactions on Graphics (TOG), 36(4), 1-13.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Twigg, C. (2003). Catmull-rom splines. Computer, 41(6), 4-6.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../installation/" class="md-footer__link md-footer__link--next" aria-label="Next: Installation" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Installation
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.94ec81fe.min.js", "version": "1.0.0"}</script>
    
    
      <script src="../assets/javascripts/bundle.48dfec6c.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>